# RentSync 好住管家 - 系統架構說明

## 📁 專案結構

```
dealer-management-system/
├── src/
│   ├── components/
│   │   ├── RentSyncMain.tsx          # RentSync 主入口（含側邊導航）
│   │   ├── KOLManagementSystem.tsx   # KOL 管理系統
│   │   ├── DealerSystemMain.tsx      # 經銷商系統
│   │   └── Login.tsx                 # 登入組件
│   │
│   ├── pages/
│   │   └── rentsync/
│   │       ├── Dashboard.tsx         # 儀表板
│   │       ├── RentContracts.tsx     # 租約管理
│   │       ├── RentCollection.tsx    # 收租模組
│   │       ├── RepairRequests.tsx    # 報修管理
│   │       ├── ServiceMarketplace.tsx # 服務市集
│   │       └── Notifications.tsx      # 通知公告
│   │
│   ├── contexts/
│   │   └── AuthContext.tsx           # 認證上下文
│   │
│   ├── lib/
│   │   └── supabase.ts               # Supabase 客戶端
│   │
│   ├── App.tsx                       # 主應用程式
│   └── main.tsx                      # 入口文件
│
├── RENTSYNC_DATABASE_SCHEMA.sql     # 資料庫結構
├── RENTSYNC_README.md               # 使用說明
├── RENTSYNC_QUICK_START.md          # 快速開始
└── RENTSYNC_ARCHITECTURE.md         # 架構說明（本文件）
```

## 🏗️ 系統架構

```
┌─────────────────────────────────────────────────────────┐
│                    使用者介面層                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────────────┐     │
│  │ 主選單   │  │ 登入頁   │  │ RentSync 主介面 │     │
│  └──────────┘  └──────────┘  └──────────────────┘     │
└─────────────────────────────────────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────┐
│                  React 組件層                            │
│  ┌──────────┐  ┌──────────┐  ┌──────────────────┐     │
│  │ 儀表板   │  │ 租約管理 │  │ 收租模組        │     │
│  └──────────┘  └──────────┘  └──────────────────┘     │
│  ┌──────────┐  ┌──────────┐  ┌──────────────────┐     │
│  │ 報修管理 │  │ 服務市集 │  │ 通知公告        │     │
│  └──────────┘  └──────────┘  └──────────────────┘     │
└─────────────────────────────────────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────┐
│                  狀態管理層                              │
│  ┌──────────────┐  ┌──────────────────────────┐        │
│  │ AuthContext  │  │ React State (useState)   │        │
│  └──────────────┘  └──────────────────────────┘        │
└─────────────────────────────────────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────┐
│                  API / 資料存取層                        │
│  ┌─────────────────────────────────────────────┐        │
│  │         Supabase Client (supabase.ts)       │        │
│  └─────────────────────────────────────────────┘        │
└─────────────────────────────────────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────┐
│                  後端服務層                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────────────┐     │
│  │ Supabase │  │ Supabase │  │ Supabase         │     │
│  │ Auth     │  │ Database │  │ Storage          │     │
│  └──────────┘  └──────────┘  └──────────────────┘     │
└─────────────────────────────────────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────┐
│                  資料庫層                                │
│  ┌────────────────────────────────────────────┐         │
│  │         PostgreSQL with RLS               │         │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐│         │
│  │  │ 房源資料 │  │ 租約資料 │  │ 租金資料 ││         │
│  │  └──────────┘  └──────────┘  └──────────┘│         │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐│         │
│  │  │ 報修資料 │  │ 服務資料 │  │ 通知資料 ││         │
│  │  └──────────┘  └──────────┘  └──────────┘│         │
│  └────────────────────────────────────────────┘         │
└─────────────────────────────────────────────────────────┘
```

## 🔄 資料流向

### 讀取資料流程
```
使用者操作 → React 組件
           ↓
    useEffect 觸發
           ↓
    調用 Supabase API
           ↓
    Supabase 驗證 RLS 權限
           ↓
    PostgreSQL 查詢資料
           ↓
    資料返回到組件
           ↓
    useState 更新狀態
           ↓
    React 重新渲染 UI
```

### 寫入資料流程
```
使用者提交表單 → React 組件處理
                ↓
         調用 Supabase API
                ↓
    Supabase 驗證 RLS 權限
                ↓
    PostgreSQL 寫入/更新資料
                ↓
         觸發資料庫觸發器
                ↓
      更新 updated_at 時間戳
                ↓
         返回操作結果
                ↓
    重新載入頁面資料
```

## 🔐 安全架構

### 認證流程
```
1. 使用者輸入 Email/密碼
2. Supabase Auth 驗證
3. 成功後產生 JWT Token
4. Token 儲存在瀏覽器
5. 後續請求自動帶上 Token
6. RLS 根據 Token 驗證權限
```

### RLS 權限控制
```
房東 (Landlord)
├── 可查看/編輯自己的房源
├── 可查看/管理自己房源的租約
├── 可查看/管理自己房源的租金記錄
├── 可查看/處理自己房源的報修單
└── 可發送通知給租客

租客 (Tenant)
├── 可查看自己的租客資料
├── 可查看自己的租約
├── 可查看自己的租金繳納記錄
├── 可提交/查看自己的報修單
├── 可預約服務
└── 可查看通知公告
```

## 📊 資料庫設計

### ER 關係圖
```
┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│  properties │───────│rent_contracts│───────│   tenants   │
│  (房源)     │  1:N  │   (租約)     │  N:1  │  (租客)     │
└─────────────┘       └─────────────┘       └─────────────┘
       │                      │
       │ 1:N                  │ 1:N
       ↓                      ↓
┌─────────────┐       ┌─────────────┐
│rent_payments│       │repair_requests│
│ (租金記錄)  │       │  (報修單)    │
└─────────────┘       └─────────────┘
                             │ 1:N
                             ↓
                     ┌─────────────┐
                     │repair_comments│
                     │ (報修留言)   │
                     └─────────────┘

┌─────────────┐       ┌─────────────┐
│service_providers│   │service_orders│
│  (服務廠商)  │───────│  (服務預約) │
└─────────────┘  1:N  └─────────────┘

┌─────────────┐       ┌─────────────┐
│notifications│───────│notification_recipients│
│  (通知)     │  1:N  │  (接收記錄)  │
└─────────────┘       └─────────────┘
```

## 🎨 UI/UX 設計原則

### 顏色系統
- **主色調**: Indigo (藍紫色) - 專業、信賴
- **成功**: Green - 已完成、已收款
- **警告**: Yellow - 待處理、即將到期
- **錯誤**: Red - 逾期、緊急
- **資訊**: Blue - 一般訊息

### 響應式設計
```
手機版 (< 768px)
├── 單欄佈局
├── 側邊欄收合
└── 卡片式設計

平板版 (768px - 1024px)
├── 雙欄佈局
├── 側邊欄可展開
└── 表格與卡片混合

桌機版 (> 1024px)
├── 多欄佈局
├── 側邊欄展開
└── 完整表格顯示
```

## 🚀 效能優化策略

### 前端優化
- ✅ React.lazy() 懶載入路由
- ✅ useState 管理組件狀態
- ✅ useEffect 控制資料載入時機
- ⏳ useMemo 快取計算結果（待實作）
- ⏳ React.memo 避免不必要的重渲染（待實作）

### 後端優化
- ✅ 資料庫索引優化
- ✅ RLS 權限過濾
- ⏳ 分頁查詢（待實作）
- ⏳ 快取機制（待實作）

### 網路優化
- ✅ Supabase 自動批次請求
- ⏳ 圖片 CDN（待實作）
- ⏳ Service Worker 離線支援（待實作）

## 🔧 開發工具鏈

### 建構工具
- **Vite** - 快速開發伺服器與打包
- **TypeScript** - 型別安全
- **Tailwind CSS** - 原子化 CSS
- **PostCSS** - CSS 處理器

### 程式碼品質
- ESLint - 程式碼檢查（可選）
- Prettier - 程式碼格式化（可選）
- TypeScript - 型別檢查

## 📦 部署架構

### 推薦部署方案
```
Vercel / Netlify (前端)
         │
         ├─ React SPA
         ├─ Static Assets
         └─ Environment Variables
               │
               ↓
        Supabase (後端)
         │
         ├─ PostgreSQL Database
         ├─ Auth Service
         ├─ Storage
         └─ Realtime
```

### 環境變數管理
```
開發環境 (.env.local)
├── VITE_SUPABASE_URL
└── VITE_SUPABASE_ANON_KEY

生產環境 (Vercel/Netlify)
├── VITE_SUPABASE_URL
└── VITE_SUPABASE_ANON_KEY
```

## 🔮 未來擴展性

### 可擴展的架構設計
- ✅ 模組化組件結構
- ✅ 清晰的資料模型
- ✅ 靈活的 RLS 權限系統
- ⏳ API Gateway 層（待規劃）
- ⏳ 微服務架構（待規劃）

### 整合潛力
- 📧 Email 服務 (SendGrid, Mailgun)
- 💬 即時通訊 (LINE, Telegram)
- 💳 金流服務 (綠界、藍新)
- 📱 行動支付 (Apple Pay, Google Pay)
- 🏦 銀行 API (自動對帳)
- 📊 分析工具 (Google Analytics)

## 📚 技術文件

### 相關文件
- [使用說明](RENTSYNC_README.md)
- [快速開始](RENTSYNC_QUICK_START.md)
- [資料庫結構](RENTSYNC_DATABASE_SCHEMA.sql)
- [本架構說明](RENTSYNC_ARCHITECTURE.md)

### 外部資源
- [React 官方文件](https://react.dev)
- [Supabase 官方文件](https://supabase.com/docs)
- [Tailwind CSS 文件](https://tailwindcss.com/docs)
- [TypeScript 手冊](https://www.typescriptlang.org/docs)

---

**RentSync 好住管家** - 模組化、安全、可擴展的租賃管理平台
